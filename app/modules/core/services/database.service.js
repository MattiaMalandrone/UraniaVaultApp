"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var core_1 = require("@angular/core");
// nativescript
var appSettings = require("application-settings");
var Sqlite = require("nativescript-sqlite");
var DatabaseService = /** @class */ (function () {
    /**
     *
     */
    function DatabaseService() {
        // "https://urania-vault-node.herokuapp.com"
        // "http://10.0.2.2:5000"
        this.removeItem(DatabaseService_1.KEYS.host);
        this.setItem(DatabaseService_1.KEYS.host, "http://10.0.2.2:5000");
    }
    DatabaseService_1 = DatabaseService;
    /**
     *
     * @param key
     * @param value
     */
    DatabaseService.prototype.setItem = function (key, value) {
        appSettings.setString(key, JSON.stringify(value));
    };
    /**
     *
     * @param key
     */
    DatabaseService.prototype.getItem = function (key) {
        var item = appSettings.getString(key);
        if (item) {
            return JSON.parse(item);
        }
        return item;
    };
    /**
     *
     * @param key
     */
    DatabaseService.prototype.removeItem = function (key) {
        appSettings.remove(key);
    };
    /**
     *
     */
    DatabaseService.prototype.initSqlite = function () {
        var _this = this;
        console.log('INIT SQLITE...');
        (new Sqlite("my.uraniaVault")).then(function (db) {
            db.execSQL("CREATE TABLE IF NOT EXISTS relations (_id INTEGER PRIMARY KEY,\n                                                              alboId TEXT,\n                                                              userId TEXT,\n                                                              status INTEGER)").then(function () {
                console.log(db);
                _this.sqliteDb = db;
                console.log('Sqlite DB Created (if not exists yet)');
            }, function (error) { return console.log("CREATE TABLE ERROR", error); });
        }, function (error) { return console.log("OPEN DB ERROR", error); });
    };
    /**
     *
     */
    DatabaseService.prototype.postSqlite = function (alboId, userId, status) {
        console.log('postSqlite....');
        return this.sqliteDb.execSQL("INSERT INTO relations (alboId, userId, status) VALUES (?, ?, ?)", [alboId, userId, status]).then(function (id) {
            console.log("INSERT RESULT", id);
        }, function (error) {
            console.log("INSERT ERROR", error);
        });
    };
    /**
     *
     */
    DatabaseService.prototype.patchSqlite = function (alboId, userId, status) {
        console.log('patchSqlite....');
        return this.sqliteDb.execSQL("UPDATE relations SET status = ? WHERE alboId = ? AND userId = ?", [status, alboId, userId]).then(function (id) {
            console.log("UPDATE RESULT", id);
        }, function (error) {
            console.log("UPDATE ERROR", error);
        });
    };
    /**
     *
     */
    DatabaseService.prototype.existsSqlite = function (alboId, userId) {
        return this.sqliteDb.get("SELECT * FROM relations WHERE alboId = ? AND userId = ?", [alboId, userId]).then(function (res) {
            console.log("RESULT SELECT", res);
            return res == null ? false : true;
        }, function (error) {
            console.log("RESULT SELECT", error);
            return error;
        });
    };
    /**
     *
     */
    DatabaseService.prototype.getOfflineData = function (userId) {
        return this.sqliteDb.get("SELECT * FROM relations WHERE userId = ?", [userId]).then(function (res) {
            console.log("RESULT SELECT", res);
            return res;
        }, function (error) {
            console.log("RESULT SELECT", error);
            return error;
        });
    };
    /**
     *
     */
    DatabaseService.prototype.removeDatabaseSqlite = function () {
        console.log("DB uraniaVault exists: ", Sqlite.exists("my.uraniaVault"));
        if (Sqlite.exists("my.uraniaVault")) {
            console.log('cancello sqlite db');
            Sqlite.deleteDatabase("my.uraniaVault");
        }
    };
    DatabaseService.KEYS = {
        currentUser: 'current-user',
        accessToken: 'access-token',
        host: 'host'
    };
    DatabaseService = DatabaseService_1 = __decorate([
        core_1.Injectable(),
        __metadata("design:paramtypes", [])
    ], DatabaseService);
    return DatabaseService;
    var DatabaseService_1;
}());
exports.DatabaseService = DatabaseService;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGF0YWJhc2Uuc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbImRhdGFiYXNlLnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSxzQ0FBMkM7QUFFM0MsZUFBZTtBQUNmLGtEQUFvRDtBQUVwRCxJQUFNLE1BQU0sR0FBRyxPQUFPLENBQUMscUJBQXFCLENBQUMsQ0FBQztBQVM5QztJQVlJOztPQUVHO0lBQ0g7UUFDSSw0Q0FBNEM7UUFDNUMseUJBQXlCO1FBQ3pCLElBQUksQ0FBQyxVQUFVLENBQUMsaUJBQWUsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDM0MsSUFBSSxDQUFDLE9BQU8sQ0FBQyxpQkFBZSxDQUFDLElBQUksQ0FBQyxJQUFJLEVBQUUsc0JBQXNCLENBQUMsQ0FBQztJQUNwRSxDQUFDO3dCQXBCUSxlQUFlO0lBc0J4Qjs7OztPQUlHO0lBQ0ksaUNBQU8sR0FBZCxVQUFlLEdBQVcsRUFBRSxLQUFVO1FBQ2xDLFdBQVcsQ0FBQyxTQUFTLENBQUMsR0FBRyxFQUFFLElBQUksQ0FBQyxTQUFTLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQztJQUN0RCxDQUFDO0lBRUQ7OztPQUdHO0lBQ0ksaUNBQU8sR0FBZCxVQUFlLEdBQVc7UUFDdEIsSUFBSSxJQUFJLEdBQUcsV0FBVyxDQUFDLFNBQVMsQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUN0QyxFQUFFLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDO1lBQ1AsTUFBTSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDNUIsQ0FBQztRQUNELE1BQU0sQ0FBQyxJQUFJLENBQUM7SUFDaEIsQ0FBQztJQUVEOzs7T0FHRztJQUNJLG9DQUFVLEdBQWpCLFVBQWtCLEdBQVc7UUFDekIsV0FBVyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQztJQUM1QixDQUFDO0lBR0Q7O09BRUc7SUFDSSxvQ0FBVSxHQUFqQjtRQUFB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QyxDQUFDLENBQUMsSUFBSSxDQUFDLFVBQUEsR0FBRztZQUNuRixPQUFPLENBQUMsR0FBRyxDQUFDLGVBQWUsRUFBRSxHQUFHLENBQUMsQ0FBQztZQUNsQyxNQUFNLENBQUMsR0FBRyxDQUFDO1FBQ2YsQ0FBQyxFQUFFLFVBQUEsS0FBSztZQUNKLE9BQU8sQ0FBQyxHQUFHLENBQUMsZUFBZSxFQUFFLEtBQUssQ0FBQyxDQUFDO1lBQ3BDLE1BQU0sQ0FBQyxLQUFLLENBQUM7UUFDakIsQ0FBQyxDQUFDLENBQUM7SUFDUCxDQUFDO0lBRUQ7O09BRUc7SUFDSSw4Q0FBb0IsR0FBM0I7UUFDSSxPQUFPLENBQUMsR0FBRyxDQUFDLHlCQUF5QixFQUFFLE1BQU0sQ0FBQyxNQUFNLENBQUMsZ0JBQWdCLENBQUMsQ0FBQyxDQUFDO1FBQ3hFLEVBQUUsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsZ0JBQWdCLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDbEMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxvQkFBb0IsQ0FBQyxDQUFDO1lBQ2xDLE1BQU0sQ0FBQyxjQUFjLENBQUMsZ0JBQWdCLENBQUMsQ0FBQztRQUM1QyxDQUFDO0lBQ0wsQ0FBQztJQTdIYSxvQkFBSSxHQUFVO1FBQ3hCLFdBQVcsRUFBRSxjQUFjO1FBQzNCLFdBQVcsRUFBRSxjQUFjO1FBQzNCLElBQUksRUFBRSxNQUFNO0tBQ2YsQ0FBQztJQVZPLGVBQWU7UUFEM0IsaUJBQVUsRUFBRTs7T0FDQSxlQUFlLENBb0kzQjtJQUFELHNCQUFDOztDQUFBLEFBcElELElBb0lDO0FBcElZLDBDQUFlIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSW5qZWN0YWJsZSB9IGZyb20gXCJAYW5ndWxhci9jb3JlXCI7XHJcblxyXG4vLyBuYXRpdmVzY3JpcHRcclxuaW1wb3J0ICogYXMgYXBwU2V0dGluZ3MgZnJvbSAnYXBwbGljYXRpb24tc2V0dGluZ3MnO1xyXG5cclxuY29uc3QgU3FsaXRlID0gcmVxdWlyZShcIm5hdGl2ZXNjcmlwdC1zcWxpdGVcIik7XHJcblxyXG5pbnRlcmZhY2UgSUtleXMge1xyXG4gICAgY3VycmVudFVzZXI6IHN0cmluZztcclxuICAgIGFjY2Vzc1Rva2VuOiBzdHJpbmc7XHJcbiAgICBob3N0OiBzdHJpbmc7XHJcbn1cclxuXHJcbkBJbmplY3RhYmxlKClcclxuZXhwb3J0IGNsYXNzIERhdGFiYXNlU2VydmljZSB7XHJcblxyXG4gICAgcHVibGljIGlzT2ZmbGluZTogYm9vbGVhbjtcclxuXHJcbiAgICBwdWJsaWMgc3FsaXRlRGI6IGFueTtcclxuXHJcbiAgICBwdWJsaWMgc3RhdGljIEtFWVM6IElLZXlzID0ge1xyXG4gICAgICAgIGN1cnJlbnRVc2VyOiAnY3VycmVudC11c2VyJyxcclxuICAgICAgICBhY2Nlc3NUb2tlbjogJ2FjY2Vzcy10b2tlbicsXHJcbiAgICAgICAgaG9zdDogJ2hvc3QnXHJcbiAgICB9O1xyXG5cclxuICAgIC8qKlxyXG4gICAgICpcclxuICAgICAqL1xyXG4gICAgY29uc3RydWN0b3IoKSB7XHJcbiAgICAgICAgLy8gXCJodHRwczovL3VyYW5pYS12YXVsdC1ub2RlLmhlcm9rdWFwcC5jb21cIlxyXG4gICAgICAgIC8vIFwiaHR0cDovLzEwLjAuMi4yOjUwMDBcIlxyXG4gICAgICAgIHRoaXMucmVtb3ZlSXRlbShEYXRhYmFzZVNlcnZpY2UuS0VZUy5ob3N0KTtcclxuICAgICAgICB0aGlzLnNldEl0ZW0oRGF0YWJhc2VTZXJ2aWNlLktFWVMuaG9zdCwgXCJodHRwOi8vMTAuMC4yLjI6NTAwMFwiKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0ga2V5XHJcbiAgICAgKiBAcGFyYW0gdmFsdWVcclxuICAgICAqL1xyXG4gICAgcHVibGljIHNldEl0ZW0oa2V5OiBzdHJpbmcsIHZhbHVlOiBhbnkpOiB2b2lkIHtcclxuICAgICAgICBhcHBTZXR0aW5ncy5zZXRTdHJpbmcoa2V5LCBKU09OLnN0cmluZ2lmeSh2YWx1ZSkpO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSBrZXlcclxuICAgICAqL1xyXG4gICAgcHVibGljIGdldEl0ZW0oa2V5OiBzdHJpbmcpOiBhbnkge1xyXG4gICAgICAgIGxldCBpdGVtID0gYXBwU2V0dGluZ3MuZ2V0U3RyaW5nKGtleSk7XHJcbiAgICAgICAgaWYgKGl0ZW0pIHtcclxuICAgICAgICAgICAgcmV0dXJuIEpTT04ucGFyc2UoaXRlbSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBpdGVtO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSBrZXlcclxuICAgICAqL1xyXG4gICAgcHVibGljIHJlbW92ZUl0ZW0oa2V5OiBzdHJpbmcpOiB2b2lkIHtcclxuICAgICAgICBhcHBTZXR0aW5ncy5yZW1vdmUoa2V5KTtcclxuICAgIH1cclxuXHJcblxyXG4gICAgLyoqXHJcbiAgICAgKlxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgaW5pdFNxbGl0ZSgpIHtcclxuICAgICAgICBjb25zb2xlLmxvZygnSU5JVCBTUUxJVEUuLi4nKTtcclxuXHJcblxyXG5cclxuICAgICAgICAobmV3IFNxbGl0ZShcIm15LnVyYW5pYVZhdWx0XCIpKS50aGVuKGRiID0+IHtcclxuICAgICAgICAgICAgZGIuZXhlY1NRTChgQ1JFQVRFIFRBQkxFIElGIE5PVCBFWElTVFMgcmVsYXRpb25zIChfaWQgSU5URUdFUiBQUklNQVJZIEtFWSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbGJvSWQgVEVYVCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1c2VySWQgVEVYVCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0dXMgSU5URUdFUilgKS50aGVuKCgpID0+IHtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGRiKTtcclxuICAgICAgICAgICAgICAgIHRoaXMuc3FsaXRlRGIgPSBkYjtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdTcWxpdGUgREIgQ3JlYXRlZCAoaWYgbm90IGV4aXN0cyB5ZXQpJyk7XHJcbiAgICAgICAgICAgIH0sIGVycm9yID0+IGNvbnNvbGUubG9nKFwiQ1JFQVRFIFRBQkxFIEVSUk9SXCIsIGVycm9yKSk7XHJcbiAgICAgICAgfSwgZXJyb3IgPT4gY29uc29sZS5sb2coXCJPUEVOIERCIEVSUk9SXCIsIGVycm9yKSk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKlxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgcG9zdFNxbGl0ZShhbGJvSWQsIHVzZXJJZCwgc3RhdHVzKSB7XHJcbiAgICAgICAgY29uc29sZS5sb2coJ3Bvc3RTcWxpdGUuLi4uJyk7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuc3FsaXRlRGIuZXhlY1NRTChcIklOU0VSVCBJTlRPIHJlbGF0aW9ucyAoYWxib0lkLCB1c2VySWQsIHN0YXR1cykgVkFMVUVTICg/LCA/LCA/KVwiLCBbYWxib0lkLCB1c2VySWQsIHN0YXR1c10pLnRoZW4oaWQgPT4ge1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcIklOU0VSVCBSRVNVTFRcIiwgaWQpO1xyXG4gICAgICAgIH0sIGVycm9yID0+IHtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coXCJJTlNFUlQgRVJST1JcIiwgZXJyb3IpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICpcclxuICAgICAqL1xyXG4gICAgcHVibGljIHBhdGNoU3FsaXRlKGFsYm9JZCwgdXNlcklkLCBzdGF0dXMpIHtcclxuICAgICAgICBjb25zb2xlLmxvZygncGF0Y2hTcWxpdGUuLi4uJyk7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuc3FsaXRlRGIuZXhlY1NRTChcIlVQREFURSByZWxhdGlvbnMgU0VUIHN0YXR1cyA9ID8gV0hFUkUgYWxib0lkID0gPyBBTkQgdXNlcklkID0gP1wiLCBbc3RhdHVzLCBhbGJvSWQsIHVzZXJJZF0pLnRoZW4oaWQgPT4ge1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcIlVQREFURSBSRVNVTFRcIiwgaWQpO1xyXG4gICAgICAgIH0sIGVycm9yID0+IHtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coXCJVUERBVEUgRVJST1JcIiwgZXJyb3IpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICpcclxuICAgICAqL1xyXG4gICAgcHVibGljIGV4aXN0c1NxbGl0ZShhbGJvSWQsIHVzZXJJZCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLnNxbGl0ZURiLmdldChcIlNFTEVDVCAqIEZST00gcmVsYXRpb25zIFdIRVJFIGFsYm9JZCA9ID8gQU5EIHVzZXJJZCA9ID9cIiwgW2FsYm9JZCwgdXNlcklkXSkudGhlbihyZXMgPT4ge1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcIlJFU1VMVCBTRUxFQ1RcIiwgcmVzKTtcclxuICAgICAgICAgICAgcmV0dXJuIHJlcyA9PSBudWxsID8gZmFsc2UgOiB0cnVlO1xyXG4gICAgICAgIH0sIGVycm9yID0+IHtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coXCJSRVNVTFQgU0VMRUNUXCIsIGVycm9yKTtcclxuICAgICAgICAgICAgcmV0dXJuIGVycm9yO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICpcclxuICAgICAqL1xyXG4gICAgcHVibGljIGdldE9mZmxpbmVEYXRhKHVzZXJJZCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLnNxbGl0ZURiLmdldChcIlNFTEVDVCAqIEZST00gcmVsYXRpb25zIFdIRVJFIHVzZXJJZCA9ID9cIiwgW3VzZXJJZF0pLnRoZW4ocmVzID0+IHtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coXCJSRVNVTFQgU0VMRUNUXCIsIHJlcyk7XHJcbiAgICAgICAgICAgIHJldHVybiByZXM7XHJcbiAgICAgICAgfSwgZXJyb3IgPT4ge1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcIlJFU1VMVCBTRUxFQ1RcIiwgZXJyb3IpO1xyXG4gICAgICAgICAgICByZXR1cm4gZXJyb3I7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKlxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgcmVtb3ZlRGF0YWJhc2VTcWxpdGUoKSB7XHJcbiAgICAgICAgY29uc29sZS5sb2coXCJEQiB1cmFuaWFWYXVsdCBleGlzdHM6IFwiLCBTcWxpdGUuZXhpc3RzKFwibXkudXJhbmlhVmF1bHRcIikpO1xyXG4gICAgICAgIGlmIChTcWxpdGUuZXhpc3RzKFwibXkudXJhbmlhVmF1bHRcIikpIHtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coJ2NhbmNlbGxvIHNxbGl0ZSBkYicpO1xyXG4gICAgICAgICAgICBTcWxpdGUuZGVsZXRlRGF0YWJhc2UoXCJteS51cmFuaWFWYXVsdFwiKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuIl19